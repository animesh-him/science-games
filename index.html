<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Science Experiments Game</title>
<style>
  :root{ --bg:#f6fbff; --card:#ffffff; --muted:#6a7682; --accent:#1667a6; --success:#15843a; --danger:#c63636; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#062233}
  header{padding:20px;text-align:center}
  header h1{margin:0;font-size:22px}
  header p{margin:6px 0;color:var(--muted);font-size:13px}
  .wrap{max-width:980px;margin:12px auto;padding:12px}
  .tiles{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:10px 0}
  .tile{padding:12px 16px;border-radius:12px;background:var(--card);box-shadow:0 8px 22px rgba(8,20,40,0.06);cursor:pointer;min-width:128px;text-align:center;font-weight:700;outline:none}
  .tile small{display:block;font-weight:500;color:var(--muted);font-size:12px;margin-top:6px}
  .hub{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 24px rgba(8,20,40,0.06);margin-top:12px}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button{cursor:pointer;border:1px solid rgba(8,20,40,0.06);background:white;padding:8px 12px;border-radius:8px}
  .small{font-size:13px;color:var(--muted)}
  .status{margin-top:10px;font-size:14px}
  .card{background:#fff;padding:12px;border-radius:10px;margin-top:12px;box-shadow:0 8px 18px rgba(8,20,40,0.04)}
  .diagram{display:flex;justify-content:center;margin-bottom:10px}
  .diagram svg{max-width:100%;height:auto;width:320px}
  .question{font-size:18px;font-weight:700;margin-bottom:10px;text-align:center}
  .options{display:flex;flex-direction:column;gap:8px}
  /* 5-8 styled options */
  .opt-btn{display:flex;gap:12px;align-items:center;padding:12px;border-radius:8px;border:1px solid #eaf5ff;background:linear-gradient(#fff,#fbfdff);text-align:left;cursor:pointer}
  .opt-letter{width:48px;height:48px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;background:#f0f6fb;color:#214a66;border:2px solid rgba(8,20,40,0.06);font-size:18px}
  .opt-letter.highlight{background:#fff4cc;color:#6f4d00;border-color:#f0d36a}
  .opt-letter.correct{background:var(--success);color:#fff}
  .opt-letter.wrong{background:var(--danger);color:#fff}
  .opt-text{font-size:16px}
  .feedback{margin-top:10px;min-height:28px;font-weight:700;text-align:center}
  .correct{color:var(--success)}
  .wrong{color:var(--danger)}
  .hint{color:#664400;background:#fff8e0;padding:8px;border-radius:8px;margin-top:8px}
  .controls-bottom{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  .footer{padding:12px;text-align:center;color:var(--muted);font-size:12px;margin-top:18px}
  @media (max-width:720px){
    .opt-letter{width:44px;height:44px}
    .diagram svg{width:260px}
    .question{font-size:16px}
  }
</style>
</head>
<body>
<header>
  <h1>Science Experiments Game</h1>
  <p>One experiment at a time ‚Äî Play or Training. For age 5‚Äì8 options are lettered and highlighted/sounded.</p>
</header>

<div class="wrap">
  <div id="stage-age">
    <div class="small" style="text-align:center;margin-bottom:8px">Choose an age group</div>
    <div class="tiles" aria-label="Age groups">
      <div class="tile" data-age="5-8" tabindex="0" onclick="selectAge('5-8', this)" onkeydown="if(event.key==='Enter'){event.preventDefault();selectAge('5-8',this)}">
        Age 5‚Äì8 <small>Beginner</small>
      </div>
      <div class="tile" data-age="8-14" tabindex="0" onclick="selectAge('8-14', this)" onkeydown="if(event.key==='Enter'){event.preventDefault();selectAge('8-14',this)}">
        Age 8‚Äì14 <small>Curious</small>
      </div>
      <div class="tile" data-age="14+" tabindex="0" onclick="selectAge('14+', this)" onkeydown="if(event.key==='Enter'){event.preventDefault();selectAge('14+',this)}">
        Age 14+ <small>Advanced</small>
      </div>
    </div>
  </div>

  <div id="stage-hub" class="hub" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
      <div>
        <h2 id="hub-title" style="margin:0">Age</h2>
        <div id="progress-display" class="small">Solved 0 / 0</div>
      </div>
      <div>
        <div class="controls">
          <button id="btn-play" onclick="setMode('play')">Play</button>
          <button id="btn-train" onclick="setMode('train')">Training</button>
          <button onclick="backToAge()">Back</button>
        </div>
        <div style="margin-top:8px">
          <button onclick="openPrintableCertificate()">Certificate</button>
        </div>
      </div>
    </div>

    <div class="status small" id="status-bar">Points: <span id="pts">0</span> ‚Ä¢ Stars: <span id="stars">0</span></div>

    <div id="experiment-card" class="card" style="display:none">
      <div id="diagram-wrapper" class="diagram" aria-hidden="false"></div>

      <div class="question" id="question-text">Question text</div>

      <div class="options" id="options-box"></div>

      <div class="feedback" id="feedback"></div>

      <div class="controls-bottom">
        <button onclick="repeatVoice()">üîÅ Repeat</button>
        <button onclick="showHint()">üí° Hint</button>
        <button id="next-btn" style="display:none" onclick="nextExperiment()">‚û° Next</button>
      </div>
    </div>

    <div id="finished-card" class="card" style="display:none">
      <div style="font-weight:700">You finished this level ‚Äî well done!</div>
      <div class="small" style="margin-top:8px">Generate a certificate or restart the level.</div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button onclick="restartLevel()">Restart</button>
        <button onclick="backToAge()">Back to Age selection</button>
      </div>
    </div>
  </div>
</div>

<div class="footer">Created &amp; Designed by Animesh</div>

<script>
/* --------------------------
   Reused SVG helpers (previous working version)
   with an improved left/right pipe diagram (left has red X)
   -------------------------- */

function svgPipeLeftRight(){
  return `
  <svg viewBox="0 0 360 140" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Two pipes side by side; left pipe blocked with an X; right pipe open to bucket">
    <rect width="360" height="140" rx="10" fill="#fff"/>
    <!-- left pipe path (blue) -->
    <path d="M60 20 v24 h20 v6 h60 v24" stroke="#2f6f99" stroke-width="18" stroke-linecap="round" fill="none"/>
    <!-- right pipe path (green) -->
    <path d="M220 20 v24 h20 v6 h60 v24" stroke="#2f9a66" stroke-width="18" stroke-linecap="round" fill="none"/>
    <!-- red cross block on left pipe -->
    <g transform="translate(158,64) rotate(-18)">
      <rect x="-12" y="-16" width="24" height="32" rx="3" fill="#c63636" />
      <line x1="-10" y1="-14" x2="10" y2="14" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
      <line x1="-10" y1="14" x2="10" y2="-14" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
    </g>
    <!-- bucket on right -->
    <rect x="280" y="76" width="60" height="44" rx="6" fill="#e6f7ff" stroke="#6a9ab5" />
    <text x="310" y="102" font-size="12" text-anchor="middle" fill="#2c6b8a">Bucket</text>
    <text x="100" y="128" font-size="12" text-anchor="middle" fill="#264e66">Left</text>
    <text x="260" y="128" font-size="12" text-anchor="middle" fill="#2f7f53">Right</text>
  </svg>`;
}

function svgCircuitDiagram(){
  return `
  <svg viewBox="0 0 340 140" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Two circuits, top closed bottom open">
    <rect width="340" height="140" rx="12" fill="#fff"/>
    <line x1="20" y1="30" x2="120" y2="30" stroke="#333" stroke-width="4"/>
    <rect x="60" y="18" width="14" height="24" fill="#222"/>
    <rect x="80" y="18" width="6" height="24" fill="#222"/>
    <circle cx="140" cy="30" r="8" fill="#ffc93b" stroke="#b36700" stroke-width="2"/>
    <text x="170" y="34" font-size="12" fill="#333">Bulb (lights)</text>

    <line x1="20" y1="90" x2="120" y2="90" stroke="#333" stroke-width="4"/>
    <rect x="60" y="78" width="14" height="24" fill="#222"/>
    <rect x="80" y="78" width="6" height="24" fill="#222"/>
    <line x1="140" y1="90" x2="200" y2="90" stroke="#333" stroke-width="4" stroke-dasharray="6,6"/>
    <text x="220" y="94" font-size="12" fill="#333">Bulb (off)</text>

    <text x="60" y="14" font-size="12" fill="#333">Complete circuit</text>
    <text x="60" y="104" font-size="12" fill="#333">Open circuit</text>
  </svg>`;
}

/* ===============================
   Experiment data (previous working set)
   - For Age 5-8: options are strings like "A: Left", "B: Right" (no images)
   - Other ages: can include imageSVG or simple options
   =============================== */

const EXPERIMENTS = {
  "5-8": [
    {
      prompt: "Which pipe will fill the bucket?",
      imageSVG: svgPipeLeftRight(),
      options: ["A: Left", "B: Right", "C: Both"],
      answer: 1,
      hint: "Find the red cross block ‚Äî the open pipe will lead to the bucket.",
      explanation: "The left pipe has a block (red cross). The right pipe is open and fills the bucket.",
      voice: "Which pipe will fill the bucket? Option A: Left. Option B: Right. Option C: Both."
    },
    {
      prompt: "Which object will float on water?",
      options: ["A: Rock", "B: Piece of wood", "C: Coin"],
      answer: 1,
      hint: "Think about which is lighter",
      explanation: "Wood floats because it is less dense than water.",
      voice: "Which object will float on water? A: Rock. B: Piece of wood. C: Coin."
    },
    {
      prompt: "Which melts faster: ice in sun or in shade?",
      options: ["A: Sun", "B: Shade", "C: Both same"],
      answer: 0,
      hint: "Where is it warmer?",
      explanation: "Ice melts faster in the sun because it is warmer.",
      voice: "Which melts faster, ice in the sun or in the shade? A: Sun. B: Shade. C: Both same."
    },
    {
      prompt: "Which makes a bigger shadow under same light?",
      options: ["A: Tall tree", "B: Small plant", "C: Feather"],
      answer: 0,
      hint: "Bigger objects cast bigger shadows",
      explanation: "A tall tree casts a larger shadow.",
      voice: "Which makes a bigger shadow? A: Tall tree. B: Small plant. C: Feather."
    },
    {
      prompt: "Which will stick to a magnet?",
      options: ["A: Paper clip", "B: Balloon", "C: Cork"],
      answer: 0,
      hint: "Made of metal",
      explanation: "A paper clip is magnetic.",
      voice: "Which will stick to a magnet? A: Paper clip. B: Balloon. C: Cork."
    }
  ],
  "8-14": [
    {
      prompt: "Which simple circuit will light the bulb?",
      imageSVG: svgCircuitDiagram(),
      options: ["Complete circuit (closed)", "Open circuit (broken)", "No battery"],
      answer: 0,
      hint: "You need a battery and a closed path",
      explanation: "A complete closed circuit allows current to flow and the bulb to light.",
      voice: "Which simple circuit will light the bulb? Closed, open, or no battery?"
    },
    {
      prompt: "Which soil drains water fastest?",
      options: ["Sand", "Clay", "Loam"],
      answer: 0,
      hint: "Large grains let water pass easily",
      explanation: "Sand drains water faster than clay or loam.",
      voice: "Which soil drains water fastest? Sand, Clay, or Loam."
    },
    {
      prompt: "What does pH measure?",
      options: ["Acidity or basicity", "Temperature", "Density"],
      answer: 0,
      hint: "Used for acids and bases",
      explanation: "pH measures acidity or basicity.",
      voice: "What does pH measure? Acidity, Temperature, or Density."
    }
  ],
  "14+": [
    {
      prompt: "Which phenomenon bends light at an interface?",
      options: ["Refraction", "Reflection", "Diffraction"],
      answer: 0,
      hint: "Light changes direction entering a new medium",
      explanation: "Refraction bends light between media.",
      voice: "Which phenomenon bends light at an interface? Refraction, Reflection, or Diffraction."
    },
    {
      prompt: "Which gas contributes to acid rain?",
      options: ["Sulfur dioxide", "Nitrogen gas", "Oxygen"],
      answer: 0,
      hint: "Emitted from burning fossil fuels",
      explanation: "Sulfur dioxide forms acids in the atmosphere, contributing to acid rain.",
      voice: "Which gas contributes to acid rain? Sulfur dioxide, Nitrogen gas, or Oxygen."
    },
    {
      prompt: "Which formula represents conservation of mechanical energy?",
      options: ["KE_i + PE_i = KE_f + PE_f", "F = ma", "P = F/A"],
      answer: 0,
      hint: "Sum of kinetic and potential energy",
      explanation: "Kinetic + potential energy is conserved in absence of non-conservative forces.",
      voice: "Which formula represents conservation of mechanical energy?"
    }
  ]
};

/* ============================
   State and helpers
   ============================ */

const storagePrefix = 'scigame_v1_';
let currentAge = null;
let currentIndex = 0;
let currentMode = 'play';
let progress = { points:0, stars:0, solved:{} };
let currentExperiment = null;
let highlightTimer = null;

function $(id){ return document.getElementById(id); }

function speak(text){
  if(!('speechSynthesis' in window)) return;
  try{ window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(text); u.lang='en-US'; window.speechSynthesis.speak(u); } catch(e){}
}

/* Select age */
function selectAge(age, el){
  stopHighlighting();
  currentAge = age;
  currentIndex = 0;
  progress = loadProgress(age);
  $('stage-age').style.display = 'none';
  $('stage-hub').style.display = 'block';
  $('hub-title').textContent = 'Age ' + age;
  updateProgressUI();
  setMode('play');
  showExperiment();
  document.querySelectorAll('.tile').forEach(t => t.setAttribute('aria-pressed','false'));
  if(el) el.setAttribute('aria-pressed','true');
}

/* Back */
function backToAge(){
  stopHighlighting();
  try{ window.speechSynthesis && window.speechSynthesis.cancel(); } catch(e){}
  currentAge = null;
  $('stage-hub').style.display = 'none';
  $('stage-age').style.display = 'block';
}

/* Storage */
function storageKey(age){ return storagePrefix + age; }
function loadProgress(age){
  const raw = localStorage.getItem(storageKey(age));
  if(!raw) return { points:0, stars:0, solved:{} };
  try{ return JSON.parse(raw); } catch(e){ return { points:0, stars:0, solved:{} }; }
}
function saveProgress(){
  if(!currentAge) return;
  localStorage.setItem(storageKey(currentAge), JSON.stringify(progress));
  updateProgressUI();
}

/* UI updates */
function updateProgressUI(){
  if(!currentAge) return;
  const total = (EXPERIMENTS[currentAge] || []).length;
  const solvedCount = Object.keys(progress.solved || {}).length;
  $('progress-display').textContent = `Solved ${solvedCount} / ${total}`;
  $('pts').textContent = progress.points || 0;
  $('stars').textContent = progress.stars || 0;
}

/* Mode */
function setMode(m){
  currentMode = (m === 'train') ? 'train' : 'play';
  $('btn-play').style.fontWeight = currentMode === 'play' ? '800' : '400';
  $('btn-train').style.fontWeight = currentMode === 'train' ? '800' : '400';
  if(currentAge) showExperiment();
}

/* Show experiment */
function showExperiment(){
  stopHighlighting();
  const list = EXPERIMENTS[currentAge] || [];
  if(currentIndex >= list.length){
    $('experiment-card').style.display = 'none';
    $('finished-card').style.display = 'block';
    updateProgressUI();
    return;
  }
  $('finished-card').style.display = 'none';
  $('experiment-card').style.display = 'block';
  currentExperiment = list[currentIndex];

  // diagram
  const di = $('diagram-wrapper');
  di.innerHTML = '';
  if(currentExperiment.imageSVG){
    di.innerHTML = currentExperiment.imageSVG;
    di.setAttribute('aria-hidden','false');
  } else {
    di.setAttribute('aria-hidden','true');
  }

  $('question-text').textContent = `(${currentIndex+1}) ${currentExperiment.prompt}`;

  // render options
  const box = $('options-box');
  box.innerHTML = '';
  const opts = currentExperiment.options || [];
  const preschool = (currentAge === '5-8');

  for(let i=0;i<opts.length;i++){
    const opt = opts[i];
    const btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.type = 'button';
    btn.setAttribute('data-index', i);

    if(preschool){
      const letter = document.createElement('div');
      letter.className = 'opt-letter';
      letter.textContent = String.fromCharCode(65 + i);
      const label = document.createElement('div');
      label.className = 'opt-text';
      label.textContent = opt;
      btn.appendChild(letter);
      btn.appendChild(label);
    } else {
      // for other ages: show text (option might be string or object)
      if(typeof opt === 'string'){
        const label = document.createElement('div');
        label.className = 'opt-text';
        label.textContent = opt;
        btn.appendChild(label);
      } else if(typeof opt === 'object'){
        // if option has imgSVG + text, show image then label (previous working format)
        if(opt.imgSVG){
          const wrap = document.createElement('div');
          wrap.innerHTML = opt.imgSVG;
          wrap.style.marginRight = '12px';
          btn.appendChild(wrap);
        }
        const label = document.createElement('div');
        label.className = 'opt-text';
        label.textContent = opt.text || '';
        btn.appendChild(label);
      }
    }

    btn.onclick = ()=> handleChoice(i);
    btn.onkeydown = (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleChoice(i); } };
    box.appendChild(btn);
  }

  $('feedback').innerHTML = '';
  $('next-btn').style.display = 'none';
  updateProgressUI();

  // if preschool -> start highlight sequence for A/B/C and voice prompts
  if(preschool){
    startHighlightSequence();
  } else {
    // speak prompt for others
    speak(currentExperiment.voice || currentExperiment.prompt);
  }

  // if training mode: auto-reveal & advance after short delay
  if(currentMode === 'train'){
    setTimeout(()=> revealTrainingThenAdvance(), 1000);
  }
}

/* Highlight sequence for preschool: highlight each letter then speak it */
function startHighlightSequence(){
  const box = $('options-box');
  const buttons = box.querySelectorAll('.opt-btn');
  let idx = 0;
  function step(){
    // clear previous highlights
    buttons.forEach(b => {
      const l = b.querySelector('.opt-letter');
      if(l) l.classList.remove('highlight');
    });
    if(idx < buttons.length){
      const b = buttons[idx];
      const letterEl = b.querySelector('.opt-letter');
      if(letterEl) letterEl.classList.add('highlight');
      const letter = letterEl ? letterEl.textContent : ('Option ' + (idx+1));
      const text = b.querySelector('.opt-text') ? b.querySelector('.opt-text').textContent.replace(/^[A-Z]:\s*/,'') : '';
      speak('Option ' + letter + ': ' + text);
      idx++;
      highlightTimer = setTimeout(step, 900);
    } else {
      // clear highlights when done
      buttons.forEach(b => { const l = b.querySelector('.opt-letter'); if(l) l.classList.remove('highlight'); });
      highlightTimer = null;
    }
  }
  step();
}

/* Stop highlight timer */
function stopHighlighting(){
  if(highlightTimer){ clearTimeout(highlightTimer); highlightTimer = null; }
  document.querySelectorAll('.opt-letter').forEach(l => l.classList.remove('highlight'));
}

/* Handle choice (Play mode): auto-advance on correct */
function handleChoice(i){
  stopHighlighting();
  if(currentMode === 'train'){ revealTrainingThenAdvance(); return; }
  const correct = (i === currentExperiment.answer);
  const fb = $('feedback');
  const btn = document.querySelector('.opt-btn[data-index="' + i + '"]');
  const letterEl = btn ? btn.querySelector('.opt-letter') : null;

  if(correct){
    if(letterEl) { letterEl.classList.add('correct'); }
    fb.innerHTML = `<div class="correct">‚úÖ Correct! ${escapeHtml(currentExperiment.explanation || '')}</div>`;
    speak('Correct. ' + (currentExperiment.explanation || 'Good job.'));
    awardPoints();
    // auto-advance after short delay
    setTimeout(()=> {
      if(letterEl) letterEl.classList.remove('correct');
      nextExperiment();
    }, 700);
  } else {
    if(letterEl) { letterEl.classList.add('wrong'); }
    fb.innerHTML = `<div class="wrong">‚ùå Wrong. Try again.</div>`;
    speak('Wrong. Try again.');
    setTimeout(()=> { if(letterEl) letterEl.classList.remove('wrong'); }, 700);
  }
}

/* Training reveal + auto-advance */
function revealTrainingThenAdvance(){
  if(!currentExperiment) return;
  const correct = currentExperiment.answer;
  const btn = document.querySelector('.opt-btn[data-index="' + correct + '"]');
  const letterEl = btn ? btn.querySelector('.opt-letter') : null;
  if(letterEl) letterEl.classList.add('correct');
  $('feedback').innerHTML = `<div class="correct">Answer: ${(currentExperiment.options && currentExperiment.options[correct]) || ''}. ${escapeHtml(currentExperiment.explanation || '')}</div>`;
  speak('Answer: ' + ((currentExperiment.options && (currentExperiment.options[correct])) || '') + '. ' + (currentExperiment.explanation || ''));
  awardPoints(); // optional ‚Äî training might give points; you can remove if undesired
  setTimeout(()=> {
    if(letterEl) letterEl.classList.remove('correct');
    nextExperiment();
  }, 1200);
}

/* Award points once */
function awardPoints(){
  const key = 'exp_' + currentIndex;
  if(progress.solved && progress.solved[key]) return;
  // quick heuristic: first try 10 else 4 (tries not tracked here for simplicity)
  const pts = 10;
  progress.points = (progress.points || 0) + pts;
  progress.stars = (progress.stars || 0) + 1;
  progress.solved[key] = Date.now();
  saveProgress();
}

/* Next */
function nextExperiment(){
  currentIndex++;
  showExperiment();
}

/* Hint & repeat */
function showHint(){
  if(!currentExperiment) return;
  $('feedback').innerHTML = `<div class="hint">Hint: ${escapeHtml(currentExperiment.hint || '')}</div>`;
  speak('Hint: ' + (currentExperiment.hint || ''));
}
function repeatVoice(){
  if(!currentExperiment) return;
  if(currentAge === '5-8'){
    startHighlightSequence();
  } else {
    speak(currentExperiment.voice || currentExperiment.prompt);
  }
}

/* Restart level */
function restartLevel(){
  currentIndex = 0;
  showExperiment();
}

/* Printable certificate */
function openPrintableCertificate(){
  if(!currentAge) return alert('Please choose an age group first.');
  const name = prompt('Enter name for the certificate:', localStorage.getItem('scigame_player_name') || '');
  if(!name) return;
  localStorage.setItem('scigame_player_name', name);
  const solved = Object.keys(progress.solved || {}).length;
  const total = (EXPERIMENTS[currentAge] || []).length;
  const points = progress.points || 0;
  const badge = (progress.stars >= 60) ? 'Gold' : (progress.stars >= 30 ? 'Silver' : (progress.stars >= 10 ? 'Bronze' : 'None'));
  const html = `
    <!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Certificate</title>
    <style>body{font-family:serif;padding:28px;text-align:center}.title{font-family:cursive;font-size:56px}.small{font-size:16px;color:#333}</style>
    </head><body>
      <div class="title">Certificate</div>
      <div style="margin-top:8px;font-size:20px">Science Experiment Games</div>
      <div style="margin-top:30px">This certifies that</div>
      <div style="margin-top:12px;font-size:28px;font-weight:700">${escapeHtml(name)}</div>
      <div style="margin-top:18px" class="small">has completed <strong>${solved}</strong> out of <strong>${total}</strong> experiments in Age <strong>${currentAge}</strong>, scoring <strong>${points}</strong> points.</div>
      <div style="margin-top:24px" class="small">Badge: ${escapeHtml(badge)}</div>
      <div style="position:fixed;bottom:18px;width:100%;text-align:center;font-size:12px;color:#444">Created &amp; Designed by Animesh</div>
      <script>setTimeout(()=>{ if(confirm('Open print dialog? Use Save as PDF to store certificate.')) window.print(); },350);</script>
    </body></html>`;
  const w = window.open('', '_blank');
  if(!w) return alert('Popup blocked ‚Äî allow popups for this site to open certificate.');
  w.document.open(); w.document.write(html); w.document.close();
}

/* Escape helper */
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

/* Init */
document.addEventListener('DOMContentLoaded', ()=>{
  // Wait for user selection
});
</script>
</body>
</html>
