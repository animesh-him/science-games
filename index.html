<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Science Experiments Game ‚Äî One Experiment At A Time</title>
<style>
  :root{--bg:#f6fbff;--card:#fff;--muted:#556;--accent:#1766a0}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,Arial,sans-serif;background:var(--bg);color:#04263f}
  header{padding:18px;text-align:center}
  header h1{margin:0;font-size:20px}
  header p{margin:6px 0;color:var(--muted);font-size:13px}
  .wrap{max-width:900px;margin:10px auto;padding:12px}
  .tiles{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:12px 0}
  .tile{padding:12px 14px;border-radius:10px;background:var(--card);box-shadow:0 6px 14px rgba(6,30,60,0.05);cursor:pointer;min-width:120px;text-align:center;font-weight:700}
  .hub{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 8px 20px rgba(6,30,60,0.06)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  button{cursor:pointer;border:1px solid rgba(6,30,60,0.06);background:white;padding:8px 12px;border-radius:8px}
  .small{font-size:13px;color:var(--muted)}
  .card{background:#fff;padding:14px;border-radius:10px;margin-top:12px;box-shadow:0 8px 20px rgba(6,30,60,0.04)}
  .question{font-weight:700;font-size:18px;margin-bottom:10px}
  .options{display:flex;flex-direction:column;gap:8px}
  .opt-btn{padding:10px;border-radius:8px;border:1px solid #e8f4ff;background:linear-gradient(#fff,#fbfdff);text-align:left}
  .feedback{margin-top:10px;font-weight:700;min-height:28px}
  .correct{color:green}
  .wrong{color:#b12}
  .hint{color:#664400;background:#fff7cc;padding:8px;border-radius:8px;margin-top:10px}
  .status{margin-top:10px;font-size:14px}
  .footer{padding:12px;text-align:center;color:var(--muted);font-size:12px;margin-top:18px}
  @media (max-width:720px){ header h1{font-size:18px} .tile{min-width:100px;padding:10px} .question{font-size:16px} }
</style>
</head>
<body>
<header>
  <h1>Science Experiments Game</h1>
  <p>One experiment at a time ‚Äî Play or Training mode. Voice prompts, points & printable certificate.</p>
</header>

<div class="wrap">
  <!-- Age selection -->
  <div id="stage-age" style="">
    <div class="small" style="text-align:center;margin-bottom:8px">Select your age group</div>
    <div class="tiles" aria-label="Age groups">
      <div class="tile" data-age="5-8" tabindex="0"
           onclick="selectAge('5-8', this)" onkeydown="if(event.key==='Enter'){event.preventDefault(); selectAge('5-8',this)}">
        Age 5‚Äì8 <div class="small">Beginner</div>
      </div>
      <div class="tile" data-age="8-14" tabindex="0"
           onclick="selectAge('8-14', this)" onkeydown="if(event.key==='Enter'){event.preventDefault(); selectAge('8-14',this)}">
        Age 8‚Äì14 <div class="small">Curious</div>
      </div>
      <div class="tile" data-age="14+" tabindex="0"
           onclick="selectAge('14+', this)" onkeydown="if(event.key==='Enter'){event.preventDefault(); selectAge('14+',this)}">
        Age 14+ <div class="small">Advanced</div>
      </div>
    </div>
  </div>

  <!-- Hub (mode choose + single-experiment area) -->
  <div id="stage-hub" class="hub" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <div>
        <h2 id="hub-title" style="margin:0">Age</h2>
        <div id="progress-display" class="small">Solved 0 / 0</div>
      </div>
      <div>
        <div class="controls">
          <button id="play-mode" onclick="setMode('play')">Play</button>
          <button id="train-mode" onclick="setMode('train')">Training</button>
          <button onclick="backToAge()">Back</button>
        </div>
        <div style="margin-top:6px">
          <button onclick="openPrintableCertificate()">Certificate</button>
        </div>
      </div>
    </div>

    <div class="status small" id="status-bar">Points: <span id="pts">0</span> ‚Ä¢ Stars: <span id="stars">0</span></div>

    <!-- single experiment card -->
    <div class="card" id="experiment-card" style="display:none">
      <div class="question" id="question-text">Question</div>
      <div class="options" id="options-box"></div>
      <div class="feedback" id="feedback"></div>
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px">
        <button onclick="repeatVoice()">üîÅ Repeat</button>
        <button onclick="showHint()">üí° Hint</button>
        <button id="next-btn" style="display:none" onclick="nextExperiment()">‚û° Next</button>
      </div>
    </div>

    <div id="no-more" style="display:none" class="card">
      <div style="font-weight:700">You finished this level ‚Äî well done!</div>
      <div class="small" style="margin-top:8px">Generate a certificate to save your progress.</div>
      <div style="margin-top:12px">
        <button onclick="restart()">Restart</button>
        <button onclick="backToAge()">Back to Age selection</button>
      </div>
    </div>
  </div>
</div>

<div class="footer">Created &amp; Designed by Animesh</div>

<!-- Lightweight scripts (no heavy libs) -->
<script>
/* ===============================
   Experiments data (kept compact)
   20 per group (per your spec)
   =============================== */
const EXPERIMENTS = {
  "5-8": [
    {"prompt":"Which object will float on water?","options":["Rock","Piece of wood","Coin"],"answer":1,"hint":"Light and less dense than water","explanation":"Wood is less dense than water so it floats.","voice":"Which object will float on water?"},
    {"prompt":"Which pipe will fill the bucket? (Left or Right)","options":["Left path","Right path"],"answer":1,"hint":"Look where the blockage is","explanation":"The right path leads to the bucket.","voice":"Which pipe will fill the bucket, left or right?"},
    {"prompt":"Which melts faster: ice in the sun or ice in the shade?","options":["Sun","Shade"],"answer":0,"hint":"Where is it warmer?","explanation":"Ice melts faster in the sun.","voice":"Which melts faster, ice in the sun or ice in the shade?"},
    {"prompt":"Which object makes a bigger shadow under the same light?","options":["Tall tree","Small plant","Feather"],"answer":0,"hint":"Bigger objects cast larger shadows","explanation":"A tall tree casts a bigger shadow.","voice":"Which object makes a bigger shadow under the same light?"},
    {"prompt":"What color do you get when you mix red and blue?","options":["Purple","Green","Orange"],"answer":0,"hint":"Red plus blue","explanation":"Red and blue make purple.","voice":"What color do you get when you mix red and blue?"},
    {"prompt":"Which animal lives in water?","options":["Fish","Dog","Bird"],"answer":0,"hint":"Breathes under water with gills","explanation":"Fish live in water.","voice":"Which animal lives in water?"},
    {"prompt":"Which object will stick to a magnet?","options":["Paper clip","Balloon","Cork"],"answer":0,"hint":"Made of metal","explanation":"A paper clip is metal and sticks to a magnet.","voice":"Which object will stick to a magnet?"},
    {"prompt":"Which does a plant need to grow?","options":["Sunlight","Candy","Video games"],"answer":0,"hint":"Plants get energy from the sun","explanation":"Plants need sunlight, water and soil.","voice":"Which does a plant need to grow?"},
    {"prompt":"Which is a push action?","options":["Opening a door by pulling","Kicking a ball","Picking up a cup"],"answer":1,"hint":"Push moves something away","explanation":"Kicking a ball is a push action.","voice":"Which is a push action?"},
    {"prompt":"Which will float: a sealed plastic bottle or a heavy metal spoon?","options":["Plastic bottle","Metal spoon","Both"],"answer":0,"hint":"Think about air inside","explanation":"A sealed plastic bottle traps air and floats.","voice":"Which will float, a sealed plastic bottle or a heavy metal spoon?"},
    {"prompt":"Which material is used to make a shadow puppet?","options":["Paper","Glass","Water"],"answer":0,"hint":"Blocks light and is easy to cut","explanation":"Paper is used for shadow puppets.","voice":"Which material is used to make a shadow puppet?"},
    {"prompt":"Which object is magnetic?","options":["Wooden spoon","Iron key","Plastic toy"],"answer":1,"hint":"Made of iron or steel","explanation":"An iron key is magnetic.","voice":"Which object is magnetic?"},
    {"prompt":"Which will sink in water?","options":["Stone","Cork","Soap"],"answer":0,"hint":"Heavy and dense objects sink","explanation":"A stone sinks because it is denser than water.","voice":"Which will sink in water?"},
    {"prompt":"What does a thermometer measure?","options":["Temperature","Speed","Color"],"answer":0,"hint":"Use to check a fever","explanation":"A thermometer measures temperature.","voice":"What does a thermometer measure?"},
    {"prompt":"Which helps a boat float more: more weight or larger surface area?","options":["More weight","Larger surface area","Softer material"],"answer":1,"hint":"Spread weight out","explanation":"Larger surface area helps buoyancy.","voice":"Which helps a boat float more, more weight or larger surface area?"},
    {"prompt":"Which object will roll easily?","options":["Ball","Block","Sheet of paper"],"answer":0,"hint":"Round objects roll","explanation":"A ball will roll easily.","voice":"Which object will roll easily?"},
    {"prompt":"Which season do leaves usually fall?","options":["Autumn","Summer","Spring"],"answer":0,"hint":"When trees prepare for winter","explanation":"Leaves fall in autumn.","voice":"Which season do leaves usually fall?"},
    {"prompt":"Which light source is the hottest?","options":["Sun","Candle","Lamp"],"answer":0,"hint":"What keeps us warm during the day?","explanation":"The Sun is the hottest source among these.","voice":"Which light source is the hottest?" },
    {"prompt":"Which will fill with air when you blow into it?","options":["Balloon","Stone","Cup"],"answer":0,"hint":"Inflates when you blow","explanation":"A balloon fills with air when blown into it.","voice":"Which will fill with air when you blow into it?"}
  ],
  "8-14": [
    {"prompt":"Which simple circuit will light the bulb?","options":["Battery + Wire + Bulb (complete loop)","Battery + Bulb (no wire)","Wire + bulb (no battery)"],"answer":0,"hint":"Complete loop and power source needed","explanation":"A battery with a closed loop lights the bulb.","voice":"Which simple circuit will light the bulb?"},
    {"prompt":"Which is a lever that makes lifting easier?","options":["Long stick under a rock (fulcrum near rock)","Short stick directly under rock","No stick"],"answer":0,"hint":"Longer lever arm reduces force","explanation":"Using a long lever reduces the effort needed.","voice":"Which lever makes lifting easier?"},
    {"prompt":"Which material transmits sound fastest?","options":["Air","Water","Steel"],"answer":2,"hint":"Solids conduct sound faster","explanation":"Sound travels fastest in steel of these options.","voice":"Which material transmits sound fastest?"},
    {"prompt":"Which shape has the least air resistance when falling?","options":["Flat sheet","Streamlined object","Parachute"],"answer":1,"hint":"Designed to reduce drag","explanation":"Streamlined shapes have less air resistance.","voice":"Which shape has the least air resistance when falling?"},
    {"prompt":"Which option shows potential energy converting to kinetic energy?","options":["Ball at top rolling down","Ball at rest on table","Ball pushed and held"],"answer":0,"hint":"Energy converts when it moves","explanation":"A ball rolling down converts potential to kinetic energy.","voice":"Which option shows potential energy converting to kinetic energy?"},
    {"prompt":"Which liquid will evaporate fastest at room temperature?","options":["Water","Honey","Vegetable oil"],"answer":0,"hint":"Less viscous liquids evaporate faster","explanation":"Water evaporates faster than honey or oil.","voice":"Which liquid will evaporate fastest at room temperature?"},
    {"prompt":"Which lens makes distant objects appear smaller?","options":["Convex","Concave","Plano"],"answer":1,"hint":"Diverging lens makes images smaller","explanation":"A concave lens makes images smaller.","voice":"Which lens makes distant objects appear smaller?"},
    {"prompt":"Which soil type drains water fastest?","options":["Sand","Clay","Loam"],"answer":0,"hint":"Large particle sizes drain quickly","explanation":"Sand drains fastest.","voice":"Which soil type drains water fastest?"},
    {"prompt":"Which produces static electricity?","options":["Rubbing balloon on hair","Putting balloon in water","Freezing balloon"],"answer":0,"hint":"Friction transfers charge","explanation":"Rubbing the balloon produces static electricity.","voice":"Which action produces static electricity?"},
    {"prompt":"Why does a metal spoon get hot in hot soup?","options":["Conduction","Convection","Radiation"],"answer":0,"hint":"Heat moves through contact","explanation":"Heat conducts along the metal to the handle.","voice":"Why does a metal spoon get hot in hot soup?"},
    {"prompt":"Which is an example of chemical change?","options":["Paper burning","Ice melting","Salt dissolving"],"answer":0,"hint":"New substances form","explanation":"Burning paper produces ash and gases.","voice":"Which is an example of a chemical change?"},
    {"prompt":"What does pH measure?","options":["Acidity or basicity","Temperature","Density"],"answer":0,"hint":"Used for acids and bases","explanation":"pH measures how acidic or basic a solution is.","voice":"What does pH measure?"},
    {"prompt":"Which device measures electrical current?","options":["Ammeter","Thermometer","Barometer"],"answer":0,"hint":"Think amps","explanation":"Ammeter measures electrical current in amperes.","voice":"Which device measures electrical current?"},
    {"prompt":"Which structure carries oxygen in blood?","options":["Red blood cells","White blood cells","Platelets"],"answer":0,"hint":"Contains hemoglobin","explanation":"Red blood cells carry oxygen using hemoglobin.","voice":"Which structure carries oxygen in blood?"},
    {"prompt":"Which best explains why oil floats on water?","options":["Oil is less dense than water","Oil is more dense than water","They mix evenly"],"answer":0,"hint":"Think which liquid floats","explanation":"Oil floats because it is less dense than water.","voice":"Which best explains why oil floats on water?"},
    {"prompt":"Which instrument measures atmospheric pressure?","options":["Barometer","Hygrometer","Anemometer"],"answer":0,"hint":"Used in weather forecasting","explanation":"A barometer measures air pressure.","voice":"Which instrument measures atmospheric pressure?"},
    {"prompt":"Which form of energy is stored in food?","options":["Chemical energy","Nuclear energy","Light energy"],"answer":0,"hint":"Released by our bodies","explanation":"Food stores chemical energy.","voice":"Which form of energy is stored in food?"}
  ],
  "14+": [
    {"prompt":"Which circuit configuration will cause a short circuit?","options":["Battery terminals connected directly by a wire","Resistor in series with lamp","Proper circuit with switch"],"answer":0,"hint":"Bypasses the load","explanation":"Connecting terminals directly causes large current (short).","voice":"Which configuration causes a short circuit?"},
    {"prompt":"Which scenario best describes the greenhouse effect?","options":["Earth traps heat from the Sun due to greenhouse gases","Sun getting closer to Earth","More clouds always cool the planet"],"answer":0,"hint":"Gases trap infrared radiation","explanation":"Greenhouse gases trap outgoing heat and warm the planet.","voice":"Which scenario best describes the greenhouse effect?"},
    {"prompt":"Which optical phenomenon bends light at an interface?","options":["Refraction","Reflection","Diffraction"],"answer":0,"hint":"Light changes direction when entering a new medium","explanation":"Refraction bends light between media.","voice":"Which phenomenon bends light at an interface?"},
    {"prompt":"Which formula represents conservation of mechanical energy?","options":["KE_initial + PE_initial = KE_final + PE_final","Force = mass √ó acceleration","Pressure = force / area"],"answer":0,"hint":"Total mechanical energy constant without losses","explanation":"KE + PE conserved in absence of non-conservative forces.","voice":"Which formula represents conservation of mechanical energy?"},
    {"prompt":"Which gas contributes to acid rain?","options":["Sulfur dioxide","Nitrogen gas","Oxygen"],"answer":0,"hint":"Produced by burning fossil fuels","explanation":"SO2 forms sulfuric acid in the atmosphere.","voice":"Which gas contributes to acid rain?"},
    {"prompt":"Which best describes an exothermic reaction?","options":["Releases heat","Absorbs heat","No temperature change"],"answer":0,"hint":"Temperature of surroundings increases","explanation":"Exothermic reactions release heat.","voice":"Which best describes an exothermic reaction?"},
    {"prompt":"Which biomolecule stores genetic information?","options":["DNA","Carbohydrate","Lipid"],"answer":0,"hint":"Located in cell nuclei","explanation":"DNA stores genetic information.","voice":"Which biomolecule stores genetic information?"},
    {"prompt":"Which method is best for separating a soluble solid from a liquid?","options":["Evaporation","Filtration","Magnetic separation"],"answer":0,"hint":"Remove the liquid","explanation":"Evaporation leaves the dissolved solid behind.","voice":"Which method separates a soluble solid from a liquid?"},
    {"prompt":"Why do metals conduct electricity?","options":["Free electrons move through the lattice","Ionic bonds break","They contain water"],"answer":0,"hint":"Delocalized electrons carry charge","explanation":"Metals have free electrons that move and carry current.","voice":"Why do metals conduct electricity?"},
    {"prompt":"Which process produces biodegradation?","options":["Microbial activity","Burning","Plastics"],"answer":0,"hint":"Living organisms break down organic matter","explanation":"Microbes decompose organic waste.","voice":"Which process produces biodegradation?"},
    {"prompt":"Which unit measures electric charge?","options":["Coulomb","Watt","Newton"],"answer":0,"hint":"Symbol C","explanation":"Charge measured in coulombs.","voice":"Which unit measures electric charge?"},
    {"prompt":"Which describes nuclear fusion?","options":["Combining light nuclei to form heavier ones","Splitting heavy nuclei","Chemical bonding"],"answer":0,"hint":"What powers the Sun","explanation":"Fusion combines nuclei releasing energy.","voice":"Which describes nuclear fusion?"},
    {"prompt":"Which law states F = ma?","options":["Newton's Second Law","Law of Conservation of Energy","Ohm's Law"],"answer":0,"hint":"Force equals mass times acceleration","explanation":"Newton's second law: F = ma.","voice":"Which law states F equals ma?"},
    {"prompt":"Which process forms sedimentary rocks?","options":["Compaction and cementation of sediments","Melting and cooling","Metamorphism"],"answer":0,"hint":"Layers build up over time","explanation":"Sediments compact and cement into sedimentary rock.","voice":"Which process forms sedimentary rocks?"},
    {"prompt":"Which property does not change during a physical change?","options":["Chemical composition","Shape","Phase"],"answer":0,"hint":"Identity remains the same","explanation":"Chemical composition doesn't change during physical change.","voice":"Which property does not change during a physical change?"},
    {"prompt":"Which regulates blood glucose in humans?","options":["Insulin and glucagon hormones","Photosynthesis","Respiration only"],"answer":0,"hint":"Pancreas secretes them","explanation":"Insulin and glucagon regulate blood glucose.","voice":"Which process regulates blood glucose in humans?"}
  ]
};

/* ===========================
   App state & helpers
   =========================== */
const storagePrefix = 'scigame_v1_';
let age = null;
let mode = 'play';
let index = 0;
let progress = { points:0, stars:0, solved:{} };
let currentExp = null;

function $(id){ return document.getElementById(id); }
function escapeHtml(s){ return (''+s).replace(/[&<>\"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":\"&#39;\"}[c] || c)); }

/* Voice */
function speak(text){
  if(!('speechSynthesis' in window)) return;
  try { window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(text); u.lang='en-US'; window.speechSynthesis.speak(u); }
  catch(e){ console.warn('speak error', e); }
}

/* Select age (called inline) */
function selectAge(a, el){
  age = a;
  index = 0;
  progress = loadProgress(a);
  $('stage-age').style.display = 'none';
  $('stage-hub').style.display = 'block';
  $('hub-title').textContent = 'Age ' + a;
  updateProgressUI();
  showExperiment();
  setMode('play');
  // mark aria pressed
  document.querySelectorAll('.tile').forEach(t => t.setAttribute('aria-pressed','false'));
  if(el) el.setAttribute('aria-pressed','true');
}

/* Back */
function backToAge(){
  // cancel speech
  try{ window.speechSynthesis && window.speechSynthesis.cancel(); }catch(e){}
  age = null;
  $('stage-hub').style.display = 'none';
  $('stage-age').style.display = '';
}

/* Load/save progress */
function storageKey(a){ return storagePrefix + a; }
function loadProgress(a){
  const raw = localStorage.getItem(storageKey(a));
  if(!raw) return { points:0, stars:0, solved:{} };
  try { return JSON.parse(raw); } catch(e){ return { points:0, stars:0, solved:{} }; }
}
function saveProgress(){
  if(!age) return;
  localStorage.setItem(storageKey(age), JSON.stringify(progress));
  updateProgressUI();
}

/* update small UI */
function updateProgressUI(){
  if(!age) return;
  const total = (EXPERIMENTS[age]||[]).length;
  const solvedCount = Object.keys(progress.solved||{}).length;
  $('progress-display').textContent = `Solved ${solvedCount} / ${total}`;
  $('pts').textContent = progress.points || 0;
  $('stars').textContent = progress.stars || 0;
}

/* Set mode */
function setMode(m){
  mode = (m === 'train') ? 'train' : 'play';
  $('play-mode').style.fontWeight = mode === 'play' ? '800' : '400';
  $('train-mode').style.fontWeight = mode === 'train' ? '800' : '400';
  // when switching mode, re-show current experiment to reflect mode
  if(age !== null) showExperiment();
}

/* Show current experiment (one at a time) */
function showExperiment(){
  const list = EXPERIMENTS[age] || [];
  if(index >= list.length){
    // finished
    $('experiment-card').style.display = 'none';
    $('no-more').style.display = 'block';
    return;
  }
  $('no-more').style.display = 'none';
  $('experiment-card').style.display = 'block';
  currentExp = list[index];
  $('question-text').textContent = `(${index+1}) ` + currentExp.prompt;
  // render options
  const box = $('options-box'); box.innerHTML = '';
  currentExp.options.forEach((opt, i) => {
    const b = document.createElement('button');
    b.className = 'opt-btn';
    b.textContent = opt;
    b.onclick = ()=> choose(i);
    // in training mode show correct highlight and disable clicking
    if(mode === 'train'){
      if(i === currentExp.answer) b.style.border = '2px solid #9fd';
    }
    box.appendChild(b);
  });
  $('feedback').innerHTML = '';
  $('next-btn').style.display = 'none';
  // speak prompt
  speak(currentExp.voice || currentExp.prompt);
}

/* choose in Play mode */
function choose(i){
  if(mode === 'train'){
    // in training mode, just show explanation and next
    showTrainingAnswer();
    return;
  }
  // play mode: check answer
  const fb = $('feedback');
  currentExp.tries = (currentExp.tries || 0) + 1;
  if(i === currentExp.answer){
    fb.innerHTML = `<div class="correct">‚úÖ Correct! ${escapeHtml(currentExp.explanation)}</div>`;
    speak('Correct! Well done.');
    awardPoints();
    $('next-btn').style.display = 'inline-block';
  } else {
    fb.innerHTML = `<div class="wrong">‚ùå Wrong. Try again.</div>`;
    speak('Wrong. Try again.');
  }
}

/* show training answer & explanation */
function showTrainingAnswer(){
  const fb = $('feedback');
  const ans = currentExp.options[currentExp.answer];
  fb.innerHTML = `<div class="correct">Answer: ${escapeHtml(ans)}. ${escapeHtml(currentExp.explanation)}</div>`;
  speak((currentExp.voice || currentExp.prompt) + '. Answer: ' + ans + '. ' + currentExp.explanation);
  $('next-btn').style.display = 'inline-block';
}

/* award points/stars once per experiment */
function awardPoints(){
  const key = 'exp_'+index;
  if(progress.solved && progress.solved[key]) return;
  let pts = 0;
  // simple scheme: first try -> 10, else -> 4
  if(currentExp.tries === 1) pts = 10;
  else pts = 4;
  progress.points = (progress.points || 0) + pts;
  progress.stars = (progress.stars || 0) + 1;
  progress.solved[key] = Date.now();
  saveProgress();
}

/* next experiment */
function nextExperiment(){
  index++;
  showExperiment();
}

/* hint */
function showHint(){
  if(!currentExp) return;
  $('feedback').innerHTML = `<div class="hint">Hint: ${escapeHtml(currentExp.hint)}</div>`;
  speak('Hint: ' + currentExp.hint);
  currentExp.usedHint = true;
}

/* repeat voice */
function repeatVoice(){
  if(!currentExp) return;
  speak(currentExp.voice || currentExp.prompt);
}

/* restart level */
function restart(){
  index = 0;
  // optionally clear solved progress for this age
  // progress = { points:0, stars:0, solved:{} }; saveProgress();
  showExperiment();
}

/* Certificate as printable HTML in new tab (fast on mobile) */
function openPrintableCertificate(){
  if(!age) return alert('Choose an age group first.');
  const name = prompt('Enter the name for the certificate:', localStorage.getItem(storagePrefix + 'player_name') || '');
  if(!name) return;
  localStorage.setItem(storagePrefix + 'player_name', name);

  const solved = Object.keys(progress.solved || {}).length;
  const total = (EXPERIMENTS[age] || []).length;
  const points = progress.points || 0;
  const badge = (progress.stars >= 60) ? 'Gold' : (progress.stars >= 30 ? 'Silver' : (progress.stars >= 10 ? 'Bronze' : 'None'));

  const html = `
    <!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Certificate</title>
    <style>body{font-family:serif;padding:28px;text-align:center} .title{font-family:cursive;font-size:56px} .small{font-size:16px;color:#333}</style>
    </head><body>
    <div class="title">Certificate</div>
    <div style="margin-top:8px;font-size:20px">Science Experiment Games</div>
    <div style="margin-top:30px">This certifies that</div>
    <div style="margin-top:12px;font-size:28px;font-weight:700">${escapeHtml(name)}</div>
    <div style="margin-top:18px" class="small">has completed <strong>${solved}</strong> out of <strong>${total}</strong> experiments in Age <strong>${age}</strong>, scoring <strong>${points}</strong> points.</div>
    <div style="margin-top:24px" class="small">Badge: ${escapeHtml(badge)}</div>
    <div style="position:fixed;bottom:18px;width:100%;text-align:center;font-size:12px;color:#444">Created &amp; Designed by Animesh</div>
    <script>setTimeout(()=>{ if(confirm('Open print dialog? (Use Save as PDF to store certificate)')) window.print(); },350);</script>
    </body></html>
  `;
  const w = window.open('', '_blank');
  if(!w) return alert('Popup blocked ‚Äî allow popups for this site to open certificate.');
  w.document.open();
  w.document.write(html);
  w.document.close();
}

/* init small */
document.addEventListener('DOMContentLoaded', ()=>{
  // nothing heavy to run on load
  console.log('App loaded: one-experiment-at-a-time version');
});
</script>
</body>
</html>
