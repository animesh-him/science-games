<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Science Experiments Game ‚Äî Mobile Friendly</title>
<style>
  :root{--bg:#f6fbff;--card:#fff;--muted:#556;--accent:#1766a0}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,Arial,sans-serif;background:var(--bg);color:#04263f}
  header{padding:18px;text-align:center}
  header h1{margin:0;font-size:20px}
  header p{margin:6px 0;color:var(--muted);font-size:13px}
  .wrap{max-width:980px;margin:10px auto;padding:12px}
  .tiles{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:12px 0}
  .tile{padding:12px 14px;border-radius:10px;background:var(--card);box-shadow:0 6px 14px rgba(6,30,60,0.05);cursor:pointer;min-width:120px;text-align:center;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
  .hub{display:flex;gap:12px;align-items:flex-start}
  .left,.right{background:var(--card);padding:10px;border-radius:10px;box-shadow:0 6px 14px rgba(6,30,60,0.04)}
  .left{flex:1}
  .right{width:260px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  button{cursor:pointer;border:1px solid rgba(6,30,60,0.06);background:white;padding:7px 10px;border-radius:8px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-top:12px}
  .card{padding:8px;border-radius:10px;background:linear-gradient(#fff,#fbfdff);border:1px solid rgba(6,30,60,0.03)}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:60}
  .modal.hidden{display:none}
  .modal-card{background:#fff;border-radius:10px;padding:12px;width:92%;max-width:640px;max-height:86vh;overflow:auto}
  .modal-header{display:flex;justify-content:space-between;align-items:center}
  .question{margin-top:8px;font-size:16px}
  .options{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .opt-btn{padding:8px 10px;border-radius:8px;border:1px solid #e6f2ff;background:#fff;min-width:100px}
  #feedback{margin-top:10px;min-height:28px;font-weight:700}
  .correct{color:green}
  .wrong{color:#b12}
  .hint{color:#664400;background:#fff7cc;padding:8px;border-radius:8px}
  .pager{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:8px}
  @media (max-width:720px){ .right{width:100%} .hub{flex-direction:column} .tiles{gap:8px} }
</style>
</head>
<body>
<header>
  <h1>Science Experiments Game</h1>
  <p>Fast, mobile-friendly. Play, learn, and print certificates (use browser Print ‚Üí Save as PDF).</p>
</header>

<div class="wrap">
  <div class="tiles" id="age-tiles">
    <div class="tile" data-age="5-8" tabindex="0" onclick="selectAge('5-8', this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault(); selectAge('5-8', this)}">
      Age 5‚Äì8 <div class="small">Beginner</div>
    </div>
    <div class="tile" data-age="8-14" tabindex="0" onclick="selectAge('8-14', this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault(); selectAge('8-14', this)}">
      Age 8‚Äì14 <div class="small">Curious</div>
    </div>
    <div class="tile" data-age="14+" tabindex="0" onclick="selectAge('14+', this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault(); selectAge('14+', this)}">
      Age 14+ <div class="small">Advanced</div>
    </div>
  </div>

  <div id="hub" class="hub" style="display:none">
    <div class="left">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h2 id="hub-title" style="margin:0;font-size:16px">Age</h2>
          <div id="progress-display" class="small">Loading...</div>
        </div>
        <div>
          <div class="controls">
            <button id="play-mode-btn" onclick="setMode('play')">Play</button>
            <button id="train-mode-btn" onclick="setMode('train')">Train</button>
            <button id="reset-btn" onclick="resetProgressConfirm()">Reset</button>
          </div>
          <div style="margin-top:6px">
            <button id="certificate-btn" onclick="openPrintableCertificate()">Certificate</button>
          </div>
        </div>
      </div>

      <div class="small status" id="status-bar" style="margin-top:10px">Points: <span id="pts">0</span> ‚Ä¢ Stars: <span id="stars">0</span></div>

      <div id="experiments-grid" class="grid" style="margin-top:12px"></div>

      <div class="pager" id="pager" style="display:none">
        <button id="prev-page" onclick="changePage(-1)">‚óÄ Prev</button>
        <div class="small" id="page-info">Page 1</div>
        <button id="next-page" onclick="changePage(1)">Next ‚ñ∂</button>
      </div>
    </div>

    <aside class="right">
      <div style="margin-bottom:12px">
        <strong>Certificate Preview</strong>
        <div class="small" style="margin-top:6px">Name: <span id="cert-name">‚Äî</span></div>
        <div class="small">Score: <span id="cert-score">‚Äî</span></div>
      </div>

      <div style="margin-top:10px">
        <strong>Help</strong>
        <div class="small" style="margin-top:6px">Tap a card ‚Üí choose an option. Use Train to see answers and explanations. Use Certificate ‚Üí Print to get a PDF on mobile.</div>
      </div>
    </aside>
  </div>
</div>

<footer style="padding:12px;text-align:center;color:var(--muted)">Created &amp; Designed by Animesh</footer>

<!-- Modal -->
<div class="modal hidden" id="modal" role="dialog" aria-modal="true">
  <div class="modal-card">
    <div class="modal-header">
      <div><strong id="modal-title">Experiment</strong><div id="modal-sub" class="small"></div></div>
      <div><button onclick="closeModal()">‚úï</button></div>
    </div>
    <div id="modal-body"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button onclick="repeatVoice()">üîÅ Repeat</button>
      <button onclick="showHint()">üí° Hint</button>
      <button id="next-btn" style="display:none" onclick="goNext()">‚û° Next</button>
    </div>
  </div>
</div>

<script>
/* -------------------------
  Experiments data (compact)
  ------------------------- */
const EXPERIMENTS = {
  "5-8": [
    {"prompt":"Which object will float on water?","options":["Rock","Piece of wood","Coin"],"answer":1,"hint":"Light and less dense than water","explanation":"Wood floats because it is less dense than water.","voice":"Which object will float on water?"},
    {"prompt":"Which pipe will fill the bucket? (Left or Right)","options":["Left path","Right path"],"answer":1,"hint":"Look where the blockage is","explanation":"Right path is open.","voice":"Which pipe will fill the bucket?"},
    {"prompt":"Which melts faster: ice in the sun or in shade?","options":["Sun","Shade"],"answer":0,"hint":"Where is it warmer?","explanation":"Ice melts faster in the sun.","voice":"Which melts faster?"},
    {"prompt":"Which object makes a bigger shadow?","options":["Tall tree","Small plant","Feather"],"answer":0,"hint":"Which blocks more light?","explanation":"Bigger object casts bigger shadow.","voice":"Which object makes a bigger shadow?"},
    {"prompt":"What color from mixing red and blue?","options":["Purple","Green","Orange"],"answer":0,"hint":"Red + Blue","explanation":"Red and blue make purple.","voice":"What color do red and blue make?"},
    {"prompt":"Which lives in water?","options":["Fish","Dog","Bird"],"answer":0,"hint":"Breathes underwater","explanation":"Fish live in water.","voice":"Which animal lives in water?"},
    {"prompt":"Which sticks to a magnet?","options":["Paper clip","Balloon","Cork"],"answer":0,"hint":"Look for metal","explanation":"Paper clip is metal and magnetic.","voice":"Which object sticks to a magnet?"},
    {"prompt":"What does a plant need to grow?","options":["Sunlight","Candy","Video games"],"answer":0,"hint":"Plants get energy from the sun","explanation":"Plants need sunlight, water, soil.","voice":"What does a plant need?"}
  ],
  "8-14": [
    {"prompt":"Which circuit lights a bulb?","options":["Battery+Wire+Bulb","Battery+Bulb(no wire)","Wire+Bulb(no battery)"],"answer":0,"hint":"Need power source and loop","explanation":"Complete circuit with battery and wire lights bulb.","voice":"Which circuit lights the bulb?"},
    {"prompt":"Which drains fastest: sand, clay, or loam?","options":["Sand","Clay","Loam"],"answer":0,"hint":"Large grains drain faster","explanation":"Sand drains fastest.","voice":"Which soil drains fastest?"},
    {"prompt":"Which shows potential‚Üíkinetic energy?","options":["Ball rolling down","Ball at rest","Ball held"],"answer":0,"hint":"Moving downwards","explanation":"Ball at top rolling down converts potential to kinetic.","voice":"Which shows potential to kinetic?"},
    {"prompt":"Why does a metal spoon get hot in soup?","options":["Conduction","Convection","Radiation"],"answer":0,"hint":"Heat through contact","explanation":"Heat travels through metal by conduction.","voice":"Why does a spoon get hot?"},
    {"prompt":"Which produces static electricity?","options":["Rubbing balloon on hair","Putting balloon in water","Freezing balloon"],"answer":0,"hint":"Friction transfers electrons","explanation":"Rubbing produces static.","voice":"What produces static electricity?"},
    {"prompt":"What does pH measure?","options":["Acidity/basicity","Temperature","Density"],"answer":0,"hint":"Used for acids and bases","explanation":"pH measures acidity or basicity.","voice":"What does pH measure?"},
    {"prompt":"Which device measures current?","options":["Ammeter","Thermometer","Barometer"],"answer":0,"hint":"Think amps","explanation":"Ammeter measures electrical current.","voice":"Which measures current?"},
    {"prompt":"Which is an example of chemical change?","options":["Paper burning","Ice melting","Salt dissolving"],"answer":0,"hint":"New substances formed","explanation":"Burning paper forms ash and gases.","voice":"Which is chemical change?"}
  ],
  "14+": [
    {"prompt":"Which causes a short circuit?","options":["Battery terminals connected by wire","Resistor in series","Proper circuit"],"answer":0,"hint":"Bypasses the load","explanation":"Directly connecting battery causes short.","voice":"Which causes a short circuit?"},
    {"prompt":"Which is refraction?","options":["Bending of light","Reflection","Diffraction"],"answer":0,"hint":"Light changes direction between media","explanation":"Refraction bends light at interfaces.","voice":"What is refraction?"},
    {"prompt":"Which formula shows conservation of mechanical energy?","options":["KEi+PEi=KEf+PEf","F=ma","P=F/A"],"answer":0,"hint":"Total energy constant without friction","explanation":"KE + PE remains constant.","voice":"Which formula shows conservation of mechanical energy?"},
    {"prompt":"Which gas contributes to acid rain?","options":["Sulfur dioxide","Nitrogen","Oxygen"],"answer":0,"hint":"From burning fossil fuels","explanation":"SO2 forms acids in atmosphere.","voice":"Which gas contributes to acid rain?"},
    {"prompt":"Which stores genetic info?","options":["DNA","Carbohydrate","Lipid"],"answer":0,"hint":"Found in nucleus","explanation":"DNA stores hereditary information.","voice":"Which stores genetic information?"},
    {"prompt":"Which method separates soluble solid from liquid?","options":["Evaporation","Filtration","Magnetic"],"answer":0,"hint":"Remove liquid to get solid","explanation":"Evaporation leaves solid behind.","voice":"Which method separates soluble solid?"},
    {"prompt":"Why conduct electricity in metals?","options":["Free electrons","Ionic bonds break","Contains water"],"answer":0,"hint":"Delocalized electrons carry current","explanation":"Metals have free electrons.","voice":"Why do metals conduct?"},
    {"prompt":"Which unit measures electric charge?","options":["Coulomb","Watt","Newton"],"answer":0,"hint":"Symbol C","explanation":"Charge measured in coulombs.","voice":"Which unit measures charge?"}
  ]
};

/* ---------- Lightweight behaviour ----------
   - Pagination (perPage setting)
   - Inline onclicks for reliability
   - Certificate opens printable window (no heavy libs)
------------------------------------------- */

const perPage = 8; // experiments per page (keeps DOM small)
let currentAge = null;
let currentPage = 0;
let progress = { points:0, stars:0, solved:{} };
let currentExp = { idx:null, tries:0, usedHint:false, answered:false };
let currentMode = 'play';

function $(id){ return document.getElementById(id); }

function speak(text){
  if(!('speechSynthesis' in window)) return;
  try { window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(text); u.lang='en-US'; window.speechSynthesis.speak(u); }
  catch(e){ console.warn(e) }
}

function storageKey(age){ return 'scigame_v1_' + age; }
function loadProgress(age){
  const raw = localStorage.getItem(storageKey(age));
  if(!raw) return { points:0, stars:0, solved:{} };
  try { return JSON.parse(raw); } catch(e){ return { points:0, stars:0, solved:{} }; }
}
function saveProgress(){
  if(!currentAge) return;
  localStorage.setItem(storageKey(currentAge), JSON.stringify(progress));
  updateUI();
}

function updateUI(){
  if(!currentAge) return;
  const total = (EXPERIMENTS[currentAge] || []).length;
  const solvedCount = Object.keys(progress.solved || {}).length;
  $('progress-display').textContent = `Solved ${solvedCount} / ${total}`;
  $('pts').textContent = progress.points || 0;
  $('stars').textContent = progress.stars || 0;
  $('cert-name').textContent = localStorage.getItem('player_name') || '‚Äî';
  $('cert-score').textContent = `${progress.points||0} pts`;
  // pager
  const pages = Math.ceil(total / perPage);
  if(pages > 1){
    $('pager').style.display = 'flex';
    $('page-info').textContent = `Page ${currentPage+1} / ${pages}`;
    $('prev-page').disabled = currentPage === 0;
    $('next-page').disabled = currentPage >= pages-1;
  } else {
    $('pager').style.display = 'none';
  }
}

function selectAge(age, tileEl){
  if(!EXPERIMENTS[age]) return alert('No experiments for ' + age);
  currentAge = age;
  currentPage = 0;
  progress = loadProgress(age);
  $('hub').style.display = 'flex';
  $('hub-title').textContent = 'Age ' + age;
  renderGrid();
  updateUI();
  setMode('play');
  // highlight tile aria-pressed
  document.querySelectorAll('.tile').forEach(t => t.setAttribute('aria-pressed','false'));
  if(tileEl) tileEl.setAttribute('aria-pressed','true');
}

function renderGrid(){
  const grid = $('experiments-grid');
  grid.innerHTML = '';
  if(!currentAge) return;
  const list = EXPERIMENTS[currentAge] || [];
  const start = currentPage * perPage;
  const end = Math.min(start + perPage, list.length);
  for(let i=start;i<end;i++){
    const exp = list[i];
    const solvedMark = progress.solved && progress.solved['e_'+i] ? '‚úÖ' : '';
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<div style="font-weight:700">Experiment ${i+1} ${solvedMark}</div>
                      <div class="small" style="margin-top:6px">${exp.prompt}</div>
                      <div style="margin-top:8px"><button onclick="openExperiment(${i})">Start</button></div>`;
    grid.appendChild(card);
  }
}

function changePage(delta){
  const total = (EXPERIMENTS[currentAge] || []).length;
  const pages = Math.ceil(total / perPage);
  currentPage = Math.max(0, Math.min(pages-1, currentPage + delta));
  renderGrid(); updateUI();
}

/* Mode */
function setMode(m){ currentMode = (m==='train') ? 'train' : 'play'; $('play-mode-btn').style.fontWeight = currentMode==='play' ? '800' : '400'; $('train-mode-btn').style.fontWeight = currentMode==='train' ? '800' : '400'; }

/* Reset */
function resetProgressConfirm(){
  if(!currentAge) return alert('Select an age group first');
  if(!confirm('Reset progress for ' + currentAge + '?')) return;
  progress = { points:0, stars:0, solved:{} };
  saveProgress(); renderGrid();
}

/* Experiment modal */
function openExperiment(idx){
  currentExp = { idx: idx, tries:0, usedHint:false, answered:false };
  const exp = EXPERIMENTS[currentAge][idx];
  $('modal-title').textContent = `Experiment ${idx+1}`;
  $('modal-sub').textContent = currentMode==='train' ? 'Training ‚Äî explanation visible' : 'Play mode';
  const body = $('modal-body'); body.innerHTML = '';
  // question
  const q = document.createElement('div'); q.className='question'; q.innerHTML = `<strong>${exp.prompt}</strong>`; body.appendChild(q);
  // options
  const opts = document.createElement('div'); opts.className='options';
  exp.options.forEach((o,i)=>{
    const b = document.createElement('button'); b.className='opt-btn'; b.textContent = o;
    b.onclick = ()=> chooseOption(i); opts.appendChild(b);
  });
  body.appendChild(opts);
  // feedback
  const fb = document.createElement('div'); fb.id = 'feedback'; body.appendChild(fb);
  // training mode
  if(currentMode === 'train'){
    const corr = exp.answer;
    Array.from(opts.children).forEach((btn,ii)=>{ if(ii===corr) btn.style.border = '2px solid #9fd'; });
    fb.innerHTML = `<div class="correct">Answer: ${exp.options[corr]}. ${exp.explanation}</div>`;
    speak(exp.voice || exp.prompt);
    $('next-btn').style.display = 'inline-block';
  } else {
    speak(exp.voice || exp.prompt);
    $('next-btn').style.display = 'none';
  }
  $('modal').classList.remove('hidden');
}

function closeModal(){ $('modal').classList.add('hidden'); $('modal-body').innerHTML = ''; try{ window.speechSynthesis && window.speechSynthesis.cancel(); }catch(e){} }

function chooseOption(i){
  if(currentExp.answered) return;
  currentExp.tries++;
  const exp = EXPERIMENTS[currentAge][currentExp.idx];
  const fb = $('feedback');
  if(i === exp.answer){
    currentExp.answered = true;
    fb.innerHTML = `<div class="correct">‚úÖ Correct! ${exp.explanation}</div>`;
    speak('Correct! Well done.');
    awardPoints();
    $('next-btn').style.display = 'inline-block';
    renderGrid();
  } else {
    fb.innerHTML = `<div class="wrong">‚ùå Wrong. Try again.</div>`;
    speak('Wrong. Try again.');
  }
}

function awardPoints(){
  const key = 'e_'+currentExp.idx;
  if(progress.solved && progress.solved[key]) return;
  let pts = 0;
  if(currentExp.tries === 1) pts = 10;
  else if(currentExp.usedHint) pts = 7;
  else pts = 4;
  progress.points = (progress.points || 0) + pts;
  progress.stars = (progress.stars || 0) + 1;
  progress.solved[key] = Date.now();
  saveProgress();
}

/* Hint & Repeat */
function showHint(){
  if(currentExp.idx === null) return;
  if(currentExp.usedHint) return;
  const exp = EXPERIMENTS[currentAge][currentExp.idx];
  $('feedback').innerHTML = `<div class="hint">Hint: ${exp.hint}</div>`;
  speak('Hint: ' + exp.hint);
  currentExp.usedHint = true;
}
function repeatVoice(){ if(currentExp.idx === null) return; const exp = EXPERIMENTS[currentAge][currentExp.idx]; speak(exp.voice || exp.prompt); }

function goNext(){ const next = currentExp.idx + 1; const total = (EXPERIMENTS[currentAge]||[]).length; if(next < total) openExperiment(next); else { closeModal(); alert('End of set ‚Äî well done!'); } }

/* CERTIFICATE ‚Äî open printable HTML in new tab (mobile-friendly)
   The user can then use browser Print ‚Üí Save as PDF (fast and avoids heavy libs).
*/
function openPrintableCertificate(){
  if(!currentAge) return alert('Select an age group first.');
  const name = prompt('Enter name for certificate:', localStorage.getItem('player_name') || '');
  if(!name) return;
  localStorage.setItem('player_name', name);
  const solved = Object.keys(progress.solved || {}).length;
  const total = (EXPERIMENTS[currentAge]||[]).length;
  const points = progress.points || 0;
  const badge = $('badges').textContent || 'No badge';
  const html = `
    <!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Certificate</title>
    <style>body{font-family:serif;padding:28px;text-align:center} .title{font-family:cursive;font-size:56px} .small{font-size:16px;color:#333}</style>
    </head><body>
    <div class="title">Certificate</div>
    <div style="margin-top:8px;font-size:20px">Science Experiment Games</div>
    <div style="margin-top:30px">This certifies that</div>
    <div style="margin-top:12px;font-size:28px;font-weight:700">${escapeHtml(name)}</div>
    <div style="margin-top:18px" class="small">has completed <strong>${solved}</strong> out of <strong>${total}</strong> experiments in Age <strong>${currentAge}</strong>, scoring <strong>${points}</strong> points.</div>
    <div style="margin-top:24px" class="small">Badge: ${escapeHtml(badge)}</div>
    <div style="position:fixed;bottom:18px;width:100%;text-align:center;font-size:12px;color:#444">Created &amp; Designed by Animesh</div>
    <script>setTimeout(()=>{ if(confirm('Open print dialog for certificate? (Use Save as PDF)')) window.print(); },350); </script>
    </body></html>
  `;
  const w = window.open('', '_blank');
  if(!w) return alert('Popup blocked ‚Äî allow popups for this site to open certificate.');
  w.document.open();
  w.document.write(html);
  w.document.close();
}

/* small helper */
function escapeHtml(s){ return (''+s).replace(/[&<>\"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":\"&#39;\"}[c])); }

/* Init: nothing heavy ‚Äî app waits for tile clicks */
document.addEventListener('DOMContentLoaded', () => {
  // nothing to do until the user selects an age
  console.log('Mobile-light app loaded. Waiting for selection.');
});
</script>
</body>
</html>
