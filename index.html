<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SCI-GAME — Diagnostic page</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:18px;background:#f6fbff;color:#04263f}
    h1{margin:0 0 8px 0}
    .tiles{display:flex;gap:12px;margin:14px 0}
    .tile{padding:14px 18px;border-radius:10px;background:#fff;border:1px solid #d6e9ff;cursor:pointer;box-shadow:0 6px 16px rgba(6,30,60,0.06)}
    .info{background:#fff;padding:12px;border-radius:10px;border:1px dashed #d0e6ff;margin-bottom:12px}
    #log{white-space:pre-wrap;background:#e9fff0;border:1px solid #b6f0c8;padding:12px;border-radius:8px;min-height:140px;overflow:auto}
    .error{background:#fff0f0;border:1px solid #f0b6b6}
    .muted{color:#556}
    button{cursor:pointer}
  </style>
</head>
<body>
  <h1>SCI-GAME Diagnostic</h1>
  <div class="info">
    <div class="muted">This page captures runtime errors and console output so we can see why your full single-file game might not respond to clicks. Click any age tile below and then copy the contents of the <strong>Debug Log</strong> box that appears.</div>
    <ul>
      <li>No DevTools needed — the log appears on screen.</li>
      <li>After copying the log paste it here and I’ll fix the problem immediately.</li>
    </ul>
  </div>

  <div class="tiles">
    <div class="tile" tabindex="0" onclick="diagnose('5-8')" onkeydown="if(event.key==='Enter'||event.key===' '){ event.preventDefault(); diagnose('5-8') }">Age 5–8</div>
    <div class="tile" tabindex="0" onclick="diagnose('8-14')" onkeydown="if(event.key==='Enter'||event.key===' '){ event.preventDefault(); diagnose('8-14') }">Age 8–14</div>
    <div class="tile" tabindex="0" onclick="diagnose('14+')" onkeydown="if(event.key==='Enter'||event.key===' '){ event.preventDefault(); diagnose('14+') }">Age 14+</div>
  </div>

  <div class="info">
    <div><strong>Environment</strong></div>
    <div class="muted">userAgent: <span id="ua"></span></div>
    <div class="muted">protocol: <span id="proto"></span></div>
    <div class="muted">page origin: <span id="origin"></span></div>
    <div class="muted">javascriptEnabled: <span id="js">pending</span></div>
  </div>

  <div>
    <div><strong>Debug Log (copy the whole box after you click a tile)</strong></div>
    <div id="log" role="log" aria-live="polite"></div>
  </div>

<script>
  // show quick environment info
  document.getElementById('ua').textContent = navigator.userAgent || 'unknown';
  document.getElementById('proto').textContent = location.protocol;
  document.getElementById('origin').textContent = location.origin;
  document.getElementById('js').textContent = 'yes';

  // append messages to the on-page log
  const logEl = document.getElementById('log');
  function appendLog(...items){
    const txt = items.map(it => {
      if(typeof it === 'object') {
        try { return JSON.stringify(it, null, 2); } catch(e){ return String(it); }
      }
      return String(it);
    }).join(' ');
    logEl.textContent += `[${new Date().toLocaleTimeString()}] ${txt}\n`;
    logEl.scrollTop = logEl.scrollHeight;
    console.log(...items);
  }

  // forward console.* to on-page log too
  (function(){
    ['log','info','warn','error'].forEach(fn=>{
      const orig = console[fn].bind(console);
      console[fn] = function(...args){
        appendLog(fn.toUpperCase()+':', ...args);
        orig(...args);
      }
    });
  })();

  // global error handler
  window.addEventListener('error', function(ev){
    appendLog('ERROR', ev.message, ' at ', ev.filename + ':' + ev.lineno + ':' + ev.colno);
    if(ev.error && ev.error.stack) appendLog('STACK', ev.error.stack);
  });

  window.addEventListener('unhandledrejection', function(ev){
    appendLog('UNHANDLED_PROMISE_REJECTION', ev.reason && (ev.reason.stack || ev.reason));
  });

  // diagnostic function called by tiles
  function diagnose(age){
    appendLog('Tile clicked for age:', age);
    // check for selectAge function
    if(typeof window.selectAge === 'function'){
      appendLog('selectAge is defined — calling selectAge("' + age + '")');
      try {
        window.selectAge(age, document.querySelector('.tile[data-age="'+age+'"]') || null);
        appendLog('selectAge call completed (no exception).');
      } catch(err){
        appendLog('Exception while calling selectAge:', err && (err.stack || err));
      }
    } else {
      appendLog('selectAge is NOT defined on window at the time of click.');
    }

    // check if modal exists, etc.
    appendLog('Window keys (first 50):', Object.keys(window).slice(0,50));
    appendLog('document.readyState:', document.readyState);
    appendLog('Any script tags on page:', document.querySelectorAll('script').length);
    // show CSP header detection attempt
    try {
      // this is a best-effort note about CSP via meta tag presence (not authoritative)
      const metas = Array.from(document.getElementsByTagName('meta')).map(m => m.getAttribute('http-equiv') || m.getAttribute('name'));
      appendLog('meta tags (http-equiv/name) sample:', metas.slice(0,10));
    } catch(e){ appendLog('meta check failed', e); }
  }

  appendLog('Diagnostic harness loaded — waiting for clicks.');
</script>

</body>
</html>
